import{z as e,y as t,M as a,C as n,N as l,d as i,c as s,J as o,O as r,r as c,e as d,m as u,q as m,B as f,D as p,G as g,k as v,l as h,g as y,o as w,j as b,A as x,E as S,F as I}from"./vue-vendor-BBGCU1Wn.js";import{h as k,p as E}from"./markdown-vendor-Bv6JUwkq.js";import{s as C}from"./image-vendor-MZO8gQip.js";import{_,a as j,u as T}from"./index-Bfnh2krm.js";import{_ as $,C as z,a as D,H as G,b as A,T as B,D as P,S as L,g as M,d as H}from"./util-C3PsSZ-G.js";import{S as O,h as W,G as q,V as R,Y as F}from"./ui-vendor-fLtyQTiu.js";const N={data:()=>({toggle:!1}),emits:["check"],props:{state:{type:Boolean,required:!0,default:!1}},created(){this.toggle=this.state},watch:{toggle(e,t){e!==t&&this.$emit("check",e)}}},V={class:"switch"};const U=_(N,[["render",function(i,s,o,r,c,d){return t(),e("label",V,[a(n("input",{class:"checkbox",type:"checkbox","onUpdate:modelValue":s[0]||(s[0]=e=>c.toggle=e)},null,512),[[l,c.toggle]]),s[1]||(s[1]=n("div",{class:"slider round"},null,-1))])}],["__scopeId","data-v-cbf54d34"]]),Y=["width","height"],Z=_(i({__name:"Spinner",props:{size:{default:24},color:{default:"#000000"}},setup(a){const l=a,i=s(()=>({width:`${l.size}px`,height:`${l.size}px`}));return(l,s)=>(t(),e("div",{class:"spinner",style:o(i.value)},[(t(),e("svg",{viewBox:"0 0 50 50",width:a.size,height:a.size},[n("circle",{class:"path",cx:"25",cy:"25",r:"20",fill:"none","stroke-width":"4",style:o({stroke:a.color})},null,4)],8,Y))],4))}}),[["__scopeId","data-v-363641dd"]]),J={class:"mx-auto w-full h-32 my-4 max-w-[450px] border border-gray-200 flex flex-row items-center bg-white rounded-md shadow-md z-0"};const X=_({},[["render",function(a,l){return t(),e("div",J,[n("a",{class:"flex flex-row items-center justify-between w-full h-full px-4 py-4",href:"https://niceshare.site/?ref=share.lovejade.cn",onClick:l[0]||(l[0]=e=>a.$reortGaEvent("recommand","footer")),target:"_blank"},[...l[1]||(l[1]=[r('<div class="flex flex-col items-center justify-around w-full h-full text-sm text-left"><p class="w-full text-base font-semibold">逍遥自在轩</p><p class="w-full text-gray-400">基于 Astro, Starlight, Svelte, Markdown, MDX，TailwindCSS, TypeScript 所构建的个人主页，快速、易用、易于访问、高度可定制。</p></div><div class="flex flex-col items-end w-1/4"><img class="w-20 h-auto border border-gray-300 rounded-md aspect-square" src="https://niceshare.site/apple-touch-icon.png"></div>',2)])])])}]]),K={class:"fixed inset-0 overflow-y-auto"},Q={class:"flex items-center justify-center min-h-full p-4 text-center"},ee={class:"flex items-center justify-start flex-auto px-2 py-2 m-4 rounded-md shadow-inner bg-slate-50"},te={class:"flex flex-col flex-wrap items-center justify-center h-20 mx-2"},ae=i({__name:"PreviewDialog",props:{visble:Boolean},emits:["change"],setup(e,{emit:a}){const l=e;let i=null;const s=a,o=c(l.visble),r=[{name:"Golden",id:"golden"},{name:"Seagreen",id:"seagreen"},{name:"Islands",id:"islands"},{name:"Twenties",id:"twenties"},{name:"Radio",id:"radio"},{name:"Bluechrome",id:"bluechrome"},{name:"Obsidian",id:"obsidian"},{name:"Vintage",id:"vintage"},{name:"Pastel Pink",id:"pastel pink"}];function v(){o.value=!1,s("change",!1)}function h(){return new Promise((e,t)=>{const a=document.getElementById("container");k(a).then(t=>{const a=t.toDataURL("image/png"),n=new Image;n.src=a,n.onload=()=>{e(n)}})})}d(()=>l.visble,e=>{o.value=e,e&&j(()=>import("./image-vendor-MZO8gQip.js").then(e=>e.p),[]).then(e=>{i=e,y(r[0].id)})});const y=async e=>{const t=await h(),a={width:t.width,height:t.height},{canvas:n,ctx:l,image:s}=w(t,a);i.filter(s,e),i.putImageData(n,l,s)};function w(e,t){const a=document.getElementById("preview-area"),n=a.getContext("2d");a.width=t.width/2,a.height=t.height/2,n.drawImage(e,0,0,t.width/2,t.height/2);return{canvas:a,ctx:n,image:i.open_image(a,n)}}function b(e){y(e.id)}const x=async e=>{const t=await h(),a={width:t.width,height:t.height},{canvas:n,ctx:l,image:s}=w(t,a);i[e](s),i.putImageData(n,l,s)};return(e,a)=>(t(),u(f(O),{appear:"",show:o.value,as:"template"},{default:m(()=>[p(f(F),{as:"div",onClose:v,class:"relative z-10"},{default:m(()=>[p(f(W),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:m(()=>[...a[3]||(a[3]=[n("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1)])]),_:1}),n("div",K,[n("div",Q,[p(f(W),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:m(()=>[p(f(q),{class:"w-full max-w-4xl p-6 overflow-hidden text-left align-middle transition-all transform bg-white shadow-xl rounded-2xl"},{default:m(()=>[p(f(R),{as:"h3",class:"text-lg font-medium leading-6 text-gray-900"},{default:m(()=>[...a[4]||(a[4]=[g(" 效果预览 ",-1)])]),_:1}),n("div",ee,[n("div",te,[a[5]||(a[5]=n("p",{class:"pb-2 font-medium text-gray-400"},"FILTERS",-1)),p($,{className:"w-36",sourceArr:r,defaultId:r[0].id,onSelected:b},null,8,["defaultId"])]),n("button",{class:"block h-12 p-2 m-2 border border-gray-300 rounded-md w-36 hover:bg-gray-50",onClick:a[0]||(a[0]=e=>x("emboss"))}," EMBOSS "),n("button",{class:"block h-12 p-2 m-2 border border-gray-300 rounded-md w-36 hover:bg-gray-50",onClick:a[1]||(a[1]=e=>x("grayscale"))}," GRAYSCALE "),n("button",{class:"block h-12 p-2 m-2 border border-gray-300 rounded-md w-36 hover:bg-gray-50",onClick:a[2]||(a[2]=e=>x("colorize"))}," COLORIZE ")]),a[6]||(a[6]=n("canvas",{id:"preview-area",class:"m-auto my-2"},null,-1))]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"]))}}),ne=v({id:"content",state:()=>{const e=window.innerWidth>=960?"laptop":"mobile";return{isWithDate:!!localStorage.getItem(G),content:localStorage.getItem(A)||P,currentTheme:localStorage.getItem(D)||B[0].id,currentSize:localStorage.getItem(z)||e}},getters:{},actions:{updateContent(e){e&&"undefined"!==e&&(this.content=e,localStorage.setItem(A,e))},updateWithDate(e){this.isWithDate=e,localStorage.setItem(G,e?"1":"")},updateCurrentTheme(e){this.currentTheme=e,localStorage.setItem(D,e)},updateCurrentSize(e){this.currentSize=e,localStorage.setItem(z,e)}}}),le={class:"flex justify-center w-full m-auto"},ie={key:0,class:"bg exclude-from-image"},se={class:"flex flex-col items-center w-full px-6 py-4 mx-auto mt-8 mb-4 bg-white rounded-md shadow-lg operate-area"},oe={class:"flex flex-wrap justify-between w-full space-x-6 item-center"},re={class:"flex justify-between flex-auto mobile-adjust md:justify-evenly"},ce={class:"flex flex-col items-center justify-between h-20"},de={class:"flex flex-col items-center justify-between h-20 select-zize"},ue={class:"flex flex-col items-center justify-between w-24 h-20"},me={class:"flex flex-row items-center justify-between w-full px-0 py-4 space-x-6 md:justify-evenly md:space-x-0",role:"group"},fe=["disabled"],pe=["disabled"],ge=_(i({__name:"Home",setup(a){const l=T(),i=ne();let{currentSize:r,currentTheme:d}=h(i);const m=c(null);let g=c(!1);const v=c(!1),k=c(!1);let _=null,j=!1,z=null,D="";const{proxy:G}=y(),A={backgroundColor:"#ffffff",quality:1,type:"png",filter:e=>{var t;return!(null==(t=e.classList)?void 0:t.contains("exclude-from-image"))}};function P(){var e;const t=(null==(e=m.value)?void 0:e.innerHTML)||"",a=d.value,n=r.value,l=i.isWithDate;return btoa(encodeURIComponent(`${t}-${a}-${n}-${l}`)).slice(0,16)}w(()=>{R(),q(),function(){const e=document.querySelector("#editor");null==e||e.addEventListener("paste",e=>{let t=(e.clipboardData||(null==e?void 0:e.dataTransfer)).getData("text/plain");t=t.replaceAll("\n","<br />");const a=window.getSelection();if(!(null==a?void 0:a.rangeCount))return!1;a.deleteFromDocument(),document.execCommand("insertHTML",!1,t),e.preventDefault()})}()});const O=s(()=>L.filter(e=>e.id===r.value)[0]),W=s(()=>B.filter(e=>e.id===d.value)[0]);function q(){if(!m.value)return;let e=document.getElementById("date-time");if(e)return e.remove();i.isWithDate&&m.value.innerHTML&&(e=`<p id='date-time' style='text-align: right;'><time>${M()}</time></p>`,m.value.innerHTML+=e)}function R(){m.value.innerHTML=E(i.content,{breaks:!0})}function F(){g.value=!0}async function N(){const e=P();_&&D===e||(j?z&&await z:(j=!0,z=new Promise(async(t,a)=>{const n=document.getElementById("container"),l=n.querySelector("#editor");try{await Promise.all([document.fonts.ready,...Array.from(n.querySelectorAll("img")).map(e=>e.complete?Promise.resolve():new Promise(t=>{e.onload=t,e.onerror=t,setTimeout(t,1e3)}))]);const a={transition:n.style.transition,animation:n.style.animation,contentEditable:l.contentEditable,transform:n.style.transform};n.style.transition="none",n.style.animation="none",n.style.transform="translateZ(0)",l.contentEditable="false",n.offsetHeight,_=await C.toBlob(n,A),Object.assign(n.style,a),l.contentEditable=a.contentEditable,D=e,t()}catch(i){l.contentEditable="true",a(i)}finally{j=!1,z=null}}),await z))}function V(){j||_||N().catch(console.error)}function Y(e){i.updateWithDate(e),q(),_=null,setTimeout(V,100),G.$reortGaEvent("home-date-change","main")}function J(e){i.updateCurrentTheme(e.id),_=null,setTimeout(V,100),G.$reortGaEvent("home-theme","main"),G.$reortGaEvent(`home-theme-${e.name}`,"main")}function K(e){i.updateCurrentSize(e.id),_=null,setTimeout(V,100),G.$reortGaEvent("home-size","main")}function Q(){m.value.innerText=i.content,G.$reortGaEvent("home-focus","main")}function ee(){i.updateContent(m.value.innerText),R(),q(),G.$reortGaEvent("home-blur","main"),setTimeout(V,100)}async function te(){if(!v.value){v.value=!0;try{if(/iPad|iPhone|iPod/.test(navigator.userAgent))return void l.info('iOS 环境暂不支持复制图片，请选择"保存图片"');if(_&&D===P()||await N(),_){if(!("clipboard"in navigator)||!window.ClipboardItem)throw new Error("当前浏览器不支持图片复制 API");const e="image/png"===_.type?_:new Blob([_],{type:"image/png"}),t=new window.ClipboardItem({"image/png":e});await navigator.clipboard.write([t]),l.success("已复制图片至您的剪切板"),G.$reortGaEvent("copy-img-success","main")}}catch(e){l.error("复制图片失败，请重试"),G.$reortGaEvent("copy-img-failed","main")}finally{G.$reortGaEvent(`copy-img-${d.value}`,"main"),v.value=!1}}}function ge(e){g.value=e,G.$reortGaEvent("preview-dialog-change","main")}async function ve(){if(!k.value){k.value=!0;try{_&&D===P()||await N(),_&&(H(_),setTimeout(()=>{l.success("已成功为你保存图片")},200)),G.$reortGaEvent("save-img-success","main")}catch(e){l.error("保存图片失败，请重试"),G.$reortGaEvent("save-img-failed","main")}finally{k.value=!1}}}return(a,l)=>(t(),e(I,null,[n("section",le,[n("div",{id:"container",class:"container",style:o([{"text-autospace":"normal"},O.value.style])},[n("div",{class:b(`${W.value.id}-box warpper`)},["official"===W.value.id?(t(),e("div",ie)):x("",!0),n("div",{class:b(["content",W.value.id])},[n("div",{id:"editor",ref_key:"editor",ref:m,onBlur:ee,onFocus:Q,class:"editor markdown",contenteditable:"true"},null,544)],2)],2)],4)]),n("div",se,[n("div",oe,[n("div",re,[n("div",ce,[l[0]||(l[0]=n("p",{class:"pb-2 font-medium text-gray-400"},"选择主题",-1)),p($,{className:"w-24",sourceArr:f(B),defaultId:f(d),onSelected:J},null,8,["sourceArr","defaultId"])]),n("div",de,[l[1]||(l[1]=n("p",{class:"pb-2 font-medium text-gray-400"},"选择尺寸",-1)),p($,{className:"w-28",sourceArr:f(L),defaultId:f(r),onSelected:K},null,8,["sourceArr","defaultId"])]),n("div",ue,[l[2]||(l[2]=n("p",{class:"pb-2 font-medium text-gray-400"},"日期",-1)),p(U,{state:f(i).isWithDate,onCheck:Y,class:"block"},null,8,["state"])])])]),n("div",me,[n("button",{class:"general-btn md:hidden",onClick:F}," 预览图片 "),n("button",{class:"space-x-1 general-btn",disabled:v.value,onClick:te},[v.value?(t(),u(Z,{key:0,size:20})):x("",!0),n("span",null,S(v.value?"复制中...":"复制图片"),1)],8,fe),n("button",{class:"space-x-1 general-btn",disabled:k.value,onClick:ve},[k.value?(t(),u(Z,{key:0,size:20})):x("",!0),n("span",null,S(k.value?"保存中...":"保存图片"),1)],8,pe)])]),p(ae,{visble:f(g),onChange:ge},null,8,["visble"]),p(X)],64))}}),[["__scopeId","data-v-5750ee18"]]);export{ge as default};
