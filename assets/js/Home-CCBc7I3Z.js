import{m as _,l as h,I as ce,x as a,J as ue,d as X,c as j,E as A,K as de,f as me,s as fe,r as T,L as pe,o as he,z as S,y as G,v as y,g as R,q as M,A as N,F as ge}from"./vue-vendor-BCFQxE-W.js";import{p as ve,s as ye}from"./libs-vendor-DrYw4QxU.js";import{_ as $,u as we}from"./index-CzlKjr4m.js";import{C as P,a as L,H as O,b as q,c as F,T as B,D as xe,S as U,g as be,_ as V,d as Se}from"./util-B72jNn95.js";import"./ui-vendor-BhLfqw3H.js";const _e={data(){return{toggle:!1}},emits:["check"],props:{state:{type:Boolean,required:!0,default:!1}},created(){this.toggle=this.state},watch:{toggle(e,s){e!==s&&this.$emit("check",e)}}},Ee={class:"switch"};function ke(e,s,o,w,m,u){return h(),_("label",Ee,[ce(a("input",{class:"checkbox",type:"checkbox","onUpdate:modelValue":s[0]||(s[0]=f=>m.toggle=f)},null,512),[[ue,m.toggle]]),s[1]||(s[1]=a("div",{class:"slider round"},null,-1))])}const Z=$(_e,[["render",ke],["__scopeId","data-v-cbf54d34"]]),Te=["width","height"],$e=X({__name:"Spinner",props:{size:{default:24},color:{default:"#000000"}},setup(e){const s=e,o=j(()=>({width:`${s.size}px`,height:`${s.size}px`}));return(w,m)=>(h(),_("div",{class:"spinner",style:A(o.value)},[(h(),_("svg",{viewBox:"0 0 50 50",width:e.size,height:e.size},[a("circle",{class:"path",cx:"25",cy:"25",r:"20",fill:"none","stroke-width":"4",style:A({stroke:e.color})},null,4)],8,Te))],4))}}),K=$($e,[["__scopeId","data-v-363641dd"]]),Ce={},Ie={class:"mx-auto w-full h-32 my-4 max-w-[450px] border border-gray-200 flex flex-row items-center bg-white rounded-md shadow-md z-0"};function We(e,s){return h(),_("div",Ie,[a("a",{class:"flex flex-row items-center justify-between w-full h-full px-4 py-4",href:"https://niceshare.site/?ref=share.lovejade.cn",onClick:s[0]||(s[0]=o=>e.$reortGaEvent("recommand","footer")),target:"_blank"},[...s[1]||(s[1]=[de('<div class="flex flex-col items-center justify-around w-full h-full text-sm text-left"><p class="w-full text-base font-semibold">逍遥自在轩</p><p class="w-full text-gray-400">基于 Astro, Starlight, Svelte, Markdown, MDX，TailwindCSS, TypeScript 所构建的个人主页，快速、易用、易于访问、高度可定制。</p></div><div class="flex flex-col items-end w-1/4"><img class="w-20 h-auto border border-gray-300 rounded-md aspect-square" src="https://niceshare.site/apple-touch-icon.png"></div>',2)])])])}const De=$(Ce,[["render",We]]),ze=me({id:"content",state:()=>{const e=window.innerWidth>=960?"laptop":"mobile";return{isWithDate:!!localStorage.getItem(q),isWithWatermark:!!localStorage.getItem(O),content:localStorage.getItem(F)||xe,currentTheme:localStorage.getItem(L)||B[0].id,currentSize:localStorage.getItem(P)||e}},getters:{},actions:{updateContent(e){!e||e==="undefined"||(this.content=e,localStorage.setItem(F,e))},updateWithDate(e){this.isWithDate=e,localStorage.setItem(q,e?"1":"")},updateWithWatermark(e){this.isWithWatermark=e,localStorage.setItem(O,e?"1":"")},updateCurrentTheme(e){this.currentTheme=e,localStorage.setItem(L,e)},updateCurrentSize(e){this.currentSize=e,localStorage.setItem(P,e)}}}),je={class:"flex justify-center w-full m-auto"},Ae={class:"flex flex-col items-center w-full px-6 py-4 mx-auto mt-8 mb-4 space-y-2 bg-white rounded-md shadow-lg operate-area"},Be={class:"flex flex-wrap justify-between w-full space-x-6 item-center"},He={class:"flex justify-between flex-auto mobile-adjust md:justify-evenly"},Ge={class:"flex flex-col items-center justify-between h-20"},Re={class:"flex flex-col items-center justify-between h-20 md:hidden"},Me={class:"flex flex-col items-center justify-between w-20 h-20"},Ne={class:"flex flex-row items-center justify-between w-full px-0 py-4 space-x-6 md:justify-evenly md:space-x-0",role:"group"},Pe={class:"flex flex-col items-center justify-between h-20"},Le=["disabled"],Oe={class:"flex flex-col items-center justify-between h-20"},qe=["disabled"],Fe={class:"flex flex-col items-center justify-between w-24 h-20 md:hidden"},Ue=X({__name:"Home",setup(e){const s=we(),o=ze();let{currentSize:w,currentTheme:m}=fe(o);const u=T(null);T(!1);const f=T(!1),g=T(!1);let i=null,E=!1,x=null,k="";const{proxy:l}=pe(),J={backgroundColor:"#ffffff",quality:1,type:"png",filter:t=>{var n;return!((n=t.classList)!=null&&n.contains("exclude-from-image"))}};function C(){var p;const t=((p=u.value)==null?void 0:p.innerHTML)||"",n=m.value,d=w.value,r=o.isWithDate,c=o.isWithWatermark;return btoa(encodeURIComponent(`${t}-${n}-${d}-${r}-${c}`)).slice(0,16)}he(()=>{H(),v(),ee()});const Q=j(()=>U.filter(t=>t.id===w.value)[0]),I=j(()=>B.filter(t=>t.id===m.value)[0]);function v(){if(!u.value)return;const t=document.getElementById("date-time");t&&t.remove();const n=document.getElementById("home-watermark");if(n&&n.remove(),!!u.value.innerHTML){if(o.isWithDate){const d=`<p id='date-time' style='text-align: right;'><time>${be()}</time></p>`;u.value.innerHTML+=d}if(o.isWithWatermark){const d=`<p id='home-watermark' style='text-align: center;padding-bottom: 1rem;' class='rainbow-text home-watermark font-bold ${I.value.id}'>「玉桃文飨轩」</p>`;u.value.innerHTML+=d}}}function H(){u.value.innerHTML=ve(o.content,{breaks:!0})}function Y(){u.value.innerText=o.content}function ee(){const t=document.querySelector("#editor");t==null||t.addEventListener("paste",n=>{let r=(n.clipboardData||(n==null?void 0:n.dataTransfer)).getData("text/plain");r=r.replaceAll(`
`,"<br />");const c=window.getSelection();if(!(c!=null&&c.rangeCount))return!1;c.deleteFromDocument(),document.execCommand("insertHTML",!1,r),n.preventDefault()})}async function W(){const t=C();if(!(i&&k===t)){if(E){x&&await x;return}E=!0,x=new Promise(async(n,d)=>{const r=document.getElementById("container"),c=r.querySelector("#editor");try{await Promise.all([document.fonts.ready,...Array.from(r.querySelectorAll("img")).map(D=>D.complete?Promise.resolve():new Promise(z=>{D.onload=z,D.onerror=z,setTimeout(z,1e3)}))]);const p={transition:r.style.transition,animation:r.style.animation,contentEditable:c.contentEditable,transform:r.style.transform};r.style.transition="none",r.style.animation="none",r.style.transform="translateZ(0)",c.contentEditable="false",r.offsetHeight,i=await ye.toBlob(r,J),Object.assign(r.style,p),c.contentEditable=p.contentEditable,k=t,n()}catch(p){c.contentEditable="true",d(p)}finally{E=!1,x=null}}),await x}}function b(){!E&&!i&&W().catch(console.error)}function te(t){o.updateWithDate(t),v(),i=null,setTimeout(b,100),l.$reortGaEvent("home-date-change","main")}function ne(t){o.updateWithWatermark(t),v(),i=null,setTimeout(b,100),l.$reortGaEvent("home-watermark-change","main")}function ae(t){o.updateCurrentTheme(t.id),v(),i=null,setTimeout(b,100),l.$reortGaEvent("home-theme","main"),l.$reortGaEvent(`home-theme-${t.name}`,"main")}function se(t){o.updateCurrentSize(t.id),v(),i=null,setTimeout(b,100),l.$reortGaEvent("home-size","main")}function oe(){Y(),l.$reortGaEvent("home-focus","main")}function re(){o.updateContent(u.value.innerText),H(),v(),l.$reortGaEvent("home-blur","main"),setTimeout(b,100)}async function ie(){if(!f.value){f.value=!0;try{if(/iPad|iPhone|iPod/.test(navigator.userAgent)){s.info('iOS 环境暂不支持复制图片，请选择"保存图片"');return}if((!i||k!==C())&&await W(),i){if(!("clipboard"in navigator)||!window.ClipboardItem)throw new Error("当前浏览器不支持图片复制 API");const n=i.type==="image/png"?i:new Blob([i],{type:"image/png"}),d=new window.ClipboardItem({"image/png":n});await navigator.clipboard.write([d]),s.success("已复制图片至您的剪切板"),l.$reortGaEvent("copy-img-success","main")}}catch{s.error("复制图片失败，请重试"),l.$reortGaEvent("copy-img-failed","main")}finally{l.$reortGaEvent(`copy-img-${m.value}`,"main"),f.value=!1}}}async function le(){if(!g.value){g.value=!0;try{(!i||k!==C())&&await W(),i&&(Se(i),setTimeout(()=>{s.success("已成功为你保存图片")},200)),l.$reortGaEvent("save-img-success","main")}catch{s.error("保存图片失败，请重试"),l.$reortGaEvent("save-img-failed","main")}finally{g.value=!1}}}return(t,n)=>(h(),_(ge,null,[a("section",je,[a("div",{id:"container",class:"container",style:A([{"text-autospace":"normal"},Q.value.style])},[a("div",{class:G(`${I.value.id}-box warpper`)},[a("div",{class:G(["content",I.value.id])},[a("div",{id:"editor",ref_key:"editor",ref:u,onBlur:re,onFocus:oe,class:"editor markdown",contenteditable:"true"},null,544)],2)],2)],4)]),a("div",Ae,[a("div",Be,[a("div",He,[a("div",Ge,[n[0]||(n[0]=a("p",{class:"font-medium text-gray-400"},"选择主题",-1)),S(V,{className:"w-24",sourceArr:y(B),defaultId:y(m),onSelected:ae},null,8,["sourceArr","defaultId"])]),a("div",Re,[n[1]||(n[1]=a("p",{class:"font-medium text-gray-400"},"选择尺寸",-1)),S(V,{className:"w-28",sourceArr:y(U),defaultId:y(w),onSelected:se},null,8,["sourceArr","defaultId"])]),a("div",Me,[n[2]||(n[2]=a("p",{class:"font-medium text-gray-400"},"日期",-1)),S(Z,{state:y(o).isWithDate,onCheck:te,class:"block"},null,8,["state"])])])]),a("div",Ne,[a("div",Pe,[n[3]||(n[3]=a("p",{class:"font-medium text-gray-400"},"选择操作",-1)),a("button",{class:"space-x-1 general-btn",disabled:f.value,onClick:ie},[f.value?(h(),R(K,{key:0,size:20})):M("",!0),a("span",null,N(f.value?"复制中...":"复制图片"),1)],8,Le)]),a("div",Oe,[n[4]||(n[4]=a("p",{class:"font-medium text-gray-400"},"选择操作",-1)),a("button",{class:"space-x-1 general-btn",disabled:g.value,onClick:le},[g.value?(h(),R(K,{key:0,size:20})):M("",!0),a("span",null,N(g.value?"保存中...":"保存图片"),1)],8,qe)]),a("div",Fe,[n[5]||(n[5]=a("p",{class:"font-medium text-gray-400"},"水印",-1)),S(Z,{state:y(o).isWithWatermark,onCheck:ne,class:"block"},null,8,["state"])])])]),S(De)],64))}}),Qe=$(Ue,[["__scopeId","data-v-e1ecb97e"]]);export{Qe as default};
